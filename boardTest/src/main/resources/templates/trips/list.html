<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<head>
    <meta charset="UTF-8"/>
    <title>์ฌํ ๊ณํ ๋ชฉ๋ก</title>
    <link rel="stylesheet" th:href="@{/css/base.css}" />
</head>
<body>
<div th:replace="~{fragments/header :: siteHeader('trips')}"></div>

<main class="wrap">

    <div class="page-header">
        <h1>์ฌํ ๊ณํ</h1>
        <a class="btn btn-primary"
           th:if="${session.LOGIN_USER == null}"
           href="#" onclick="openLoginModal(event)">+ ์ ๊ณํ</a>

        <a class="btn btn-primary"
           th:if="${session.LOGIN_USER != null}"
           th:href="@{/trips/new}">+ ์ ๊ณํ</a>
    </div>

    <div th:if="${msg}" class="alert success" th:text="${msg}"></div>
    <div th:if="${error}" class="alert danger" th:text="${error}"></div>

    <section class="trip-list">
        <div class="trip-card" th:each="p : ${plans.content}">
            <div class="trip-card__title">
                <a th:text="${p.title}" th:href="@{|/trips/${p.id}|}"></a>
            </div>

            <div class="trip-card__meta">
                <span>๐ ๊ธฐ๊ฐ: <b th:text="${p.startDate} + ' ~ ' + ${p.endDate}"></b></span>
                <span>๐ค ์์ฑ์:
                    <b th:text="${p.owner != null ? p.owner.name : '์ ์ ์์'}"></b>
                </span>
                <span>๐ ์์ฑ์ผ:
                    <b th:text="${#temporals.format(p.createdAt,'yyyy-MM-dd HH:mm')}"></b>
                </span>
            </div>
        </div>

        <div th:if="${plans.content.size()==0}" class="empty">
            ๋ฑ๋ก๋ ์ฌํ ๊ณํ์ด ์์ต๋๋ค.
        </div>
    </section>

    <div class="pagination">
        <a class="btn" th:if="${!plans.first}"
           th:href="@{/trips(page=${plans.number-1})}">์ด์</a>

        <span th:text="${plans.number+1} + ' / ' + ${plans.totalPages}"></span>

        <a class="btn" th:if="${!plans.last}"
           th:href="@{/trips(page=${plans.number+1})}">๋ค์</a>
    </div>
</main>


<div th:replace="~{fragments/footer :: siteFooter}"></div>

<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
    function openLoginModal(e) {
      e.preventDefault();
      if (typeof Swal === 'undefined') {
        if (confirm('๋ก๊ทธ์ธ์ด ํ์ํฉ๋๋ค.\n๋ก๊ทธ์ธํ์๊ฒ์ต๋๊น?')) {
          window.location.href = '/login?next=/trips/new';
        }
        return;
      }
      Swal.fire({
        title: '๋ก๊ทธ์ธ์ด ํ์ํฉ๋๋ค',
        text: '๋ก๊ทธ์ธํ์๊ฒ์ต๋๊น?',
        icon: 'question',
        showCancelButton: true,
        confirmButtonText: '๋ก๊ทธ์ธํ๊ธฐ',
        cancelButtonText: '์ทจ์',
        reverseButtons: true,
        focusConfirm: false
      }).then((r) => {
        if (r.isConfirmed) window.location.href = '/login?next=/trips/new';
      });
    }
</script>
</body>
</html>
